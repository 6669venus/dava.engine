# Copyright (c) 2013 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# GNU Makefile based on shared rules provided by the Native Client SDK.
# See README.Makefiles for more details.
VALID_TOOLCHAINS := $(TOOLCHAIN)
NACL_ARCH?=x86_64
##NACL_ARCH?=x86_32
NACL_SDK_ROOT ?= $(abspath $(CURDIR)../../../../../pepper_31/)
include $(NACL_SDK_ROOT)/tools/common.mk

BASE_CFLAGS:=-Werror -Wno-write-strings -Wno-trigraphs


##SOURCE_DIRS := .\
##				../
				
INCLUDE_DIRS = .. \
				../../ \
##				$(NACL_SDK_ROOT)/toolchain/mac_x86_newlib/x86_64-nacl/usr/include/glibc-compat \
##				$(NACL_SDK_ROOT)/toolchain/mac_x86_newlib/x86_64-nacl/usr/include/ \
###				$(NACL_SDK_ROOT)/../dava.framework/Libs/NaClSocket/src \

SOURCE_FILES:=../jcapimin.c \
                   ../jcapistd.c \
                   ../jccoefct.c \
                   ../jccolor.c \
                   ../jcdctmgr.c \
                   ../jchuff.c \
                   ../jcinit.c \
                   ../jcmainct.c \
                   ../jcmarker.c \
                   ../jcmaster.c \
                   ../jcomapi.c \
                   ../jcparam.c \
                   ../jcprepct.c \
                   ../jcsample.c \
                   ../jctrans.c \
                   ../jdapimin.c \
                   ../jdapistd.c \
                   ../jdatadst.c \
                   ../jdatasrc.c \
                   ../jdcoefct.c \
                   ../jdcolor.c \
                   ../jdhuff.c \
                   ../jddctmgr.c \
                   ../jdinput.c \
                   ../jdmainct.c \
                   ../jdmarker.c \
                   ../jdmaster.c \
                   ../jdmerge.c \
                   ../jdpostct.c \
                   ../jdsample.c \
                   ../jdtrans.c \
                   ../jerror.c \
                   ../jfdctflt.c \
                   ../jfdctfst.c \
                   ../jfdctint.c \
                   ../jquant1.c \
                   ../jquant2.c \
                   ../jutils.c \
                   ../jmemmgr.c \
                   ../jmemansi.c \
                   ../jidctint.c \
                   ../jdarith.c \
                   ../jcarith.c \
                   ../jidctfst.c \
                   ../jidctflt.c \
                   ../jaricom.c
				
##SEARCH_WILDCARDS := $(addsuffix /*.cpp,$(SOURCE_DIRS)) 
##override COMPILE_FLAGS += -g -O0 -pipe -w -Werror -Wno-write-strings -Wno-trigraphs
override COMPILE_FLAGS += -pipe -w -Werror -Wno-write-strings -Wno-trigraphs -fstrict-aliasing -fprefetch-loop-arrays
override BUILD_FLAGS += -D__DAVAENGINE_NACL__ -DAVOID_TABLES -DANDROID_TILE_BASED_DECODE -Wno-deprecated -w

NACL_LDFLAGS=$(LIB_PATH)
TARGET = jpeg

CFLAGS = $(BUILD_FLAGS) $(COMPILE_FLAGS) $(addprefix -I, $(INCLUDE_DIRS)) $(LIB_PATH) 
##SOURCES = $(wildcard $(SEARCH_WILDCARDS))
##SOURCES = $(addprefix ../,$(SOURCE_FILES))
SOURCES = $(SOURCE_FILES)
# Build rules generated by macros from common.mk:

$(foreach src,$(SOURCES),$(eval $(call COMPILE_RULE,$(src),$(CFLAGS))))

ifeq ($(CONFIG),Release)
$(eval $(call LIB_RULE,$(TARGET),$(SOURCES),$(LIBS),$(DEPS)))
##$(eval $(call STRIP_RULE,$(TARGET),$(TARGET)_unstripped))
else
$(eval $(call LIB_RULE,$(TARGET),$(SOURCES),$(LIBS),$(DEPS)))
endif

##copy:
##	cp ./$(TOOLCHAIN)/$(CONFIG)/lib$(TARGET)_$(NACL_ARCH).a ../../../LibsNaCl/$(CONFIG)/$(TOOLCHAIN)_$(NACL_ARCH)/
##$(eval $(call NMF_RULE,$(TARGET),))

