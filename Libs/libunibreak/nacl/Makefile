# Copyright (c) 2013 The Chromium Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# GNU Makefile based on shared rules provided by the Native Client SDK.
# See README.Makefiles for more details.
VALID_TOOLCHAINS := $(TOOLCHAIN)
NACL_ARCH?=x86_64
##NACL_ARCH?=x86_32
NACL_SDK_ROOT ?= $(abspath $(CURDIR)../../../../../pepper_31/)
include $(NACL_SDK_ROOT)/tools/common.mk

BASE_CFLAGS:=-Werror -Wno-write-strings -Wno-trigraphs


##SOURCE_DIRS := .\
##				../
				
INCLUDE_DIRS = .. \
				../../ \
##				$(NACL_SDK_ROOT)/toolchain/mac_x86_newlib/x86_64-nacl/usr/include/glibc-compat \
##				$(NACL_SDK_ROOT)/toolchain/mac_x86_newlib/x86_64-nacl/usr/include/ \
###				$(NACL_SDK_ROOT)/../dava.framework/Libs/NaClSocket/src \

SOURCE_FILES:= ../src/linebreak.c \
                  ../src/linebreakdata.c \
                  ../src/linebreakdef.c \
                  ../src/wordbreak.c \
                  ../src/wordbreakdata.c 
				
##SEARCH_WILDCARDS := $(addsuffix /*.cpp,$(SOURCE_DIRS)) 
##override COMPILE_FLAGS += -g -O0 -pipe -w -Werror -Wno-write-strings -Wno-trigraphs
override COMPILE_FLAGS += -pipe -w -Werror -Wno-write-strings -Wno-trigraphs -fstrict-aliasing -fprefetch-loop-arrays
override BUILD_FLAGS += -D__DAVAENGINE_NACL__ -Wno-deprecated -w

NACL_LDFLAGS=$(LIB_PATH)
TARGET = unibreak

CFLAGS = $(BUILD_FLAGS) $(COMPILE_FLAGS) $(addprefix -I, $(INCLUDE_DIRS)) $(LIB_PATH) 
##SOURCES = $(wildcard $(SEARCH_WILDCARDS))
##SOURCES = $(addprefix ../,$(SOURCE_FILES))
SOURCES = $(SOURCE_FILES)
# Build rules generated by macros from common.mk:

$(foreach src,$(SOURCES),$(eval $(call COMPILE_RULE,$(src),$(CFLAGS))))

ifeq ($(CONFIG),Release)
$(eval $(call LIB_RULE,$(TARGET),$(SOURCES),$(LIBS),$(DEPS)))
##$(eval $(call STRIP_RULE,$(TARGET),$(TARGET)_unstripped))
else
$(eval $(call LIB_RULE,$(TARGET),$(SOURCES),$(LIBS),$(DEPS)))
endif

##copy:
##	cp ./$(TOOLCHAIN)/$(CONFIG)/lib$(TARGET)_$(NACL_ARCH).a ../../../LibsNaCl/$(CONFIG)/$(TOOLCHAIN)_$(NACL_ARCH)/
##$(eval $(call NMF_RULE,$(TARGET),))

